<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="org.zerock.myapp.mapper.ProductMapper">
    <select id="SelectOrder" resultType="org.zerock.myapp.domain.ProductVO">
        SELECT pno, pname, content, image, price, discount, 
        brandname, insert_ts, readcount, (price - (price * (discount / 100))) - mod(price - 
        (price * (discount /100)), 10) as disprice 
        FROM product_list
        ORDER BY #{order} asc
        OFFSET ( #{currPage} -1) * #{amount} ROWS FETCH NEXT #{amount} ROWS ONLY
    </select>

    <select id="SelectDetail" resultType="org.zerock.myapp.domain.ProductDTO">
        SELECT pno, pname, content, image, price, discount, 
        brandname, insert_ts, readcount, (price - (price * (discount / 100))) - mod(price - 
        (price * (discount /100)), 10) as disprice, subimage1, subimage2, subimage3, subimage4
        FROM product_list
        WHERE pno = #{pno}
    </select>
    

    <!-- [별이] 관리자페이지 상품 등록 -->
    
    <!-- 상품 등록 -->
    <insert id="insert" >
    
    	<selectKey resultType="int" keyProperty="no" order="AFTER">
    		SELECT "MYMG"."ISEQ$$_103743".currval FROM DUAL
    	</selectKey>
    
        INSERT
        INTO PRODUCT (category, name, price, discount, discount_price, weight, origin, stock, farm_no, main_image, sub_image1, sub_image2, sub_image3, sub_image4, content, content_image)
      	VALUES (#{category}, #{name}, #{price}, #{discount}, #{discount_price}, #{weight}, #{origin}, #{stock}, #{farm_no}, #{main_image}, #{sub_image1}, #{sub_image2}, #{sub_image3}, #{sub_image4}, #{content}, #{content_image})    
    </insert>
	
	<!-- 상품 이미지 등록 -->
	<insert id="imageInsert">
		INSERT
		INTO MYMG_IMAGE(product_no, fileName, uploadPath, uuid) 
		VALUES (#{product_no}, #{fileName}, #{uploadPath}, #{uuid})
	</insert>
	
	<!-- 카테고리 등록 -->
	<select id="cateList" resultType="org.zerock.myapp.domain.CategoryVO">
		SELECT * FROM category ORDER BY code
	</select> 
    
</mapper>